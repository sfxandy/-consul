version: "3.8"

# Per-host external secrets (created by tasks/secrets.yml)
secrets:
  consul_agent_token_server_node:
    external: true
    name: {{ (consul_secret_prefix | default('consul_agent_token_')) ~ consul_server_node_name }}
  consul_agent_token_client_node:
    external: true
    name: {{ (consul_secret_prefix | default('consul_agent_token_')) ~ consul_client_node_name }}

services:
  consul-server:
    secrets:
      - source: consul_agent_token_server_node
        target: {{ podman_secret_target_server }}
        mode: 0440

  consul-agent:
    secrets:
      - source: consul_agent_token_client_node
        target: {{ podman_secret_target_client }}
        mode: 0440
